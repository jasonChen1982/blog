---
title: bezier-easing实现平滑的插值
date: 2014-11-25
status: finished
author: jason82
---

我们都知道，`CSS3`里面的插值函数用的是`beizer`曲线。如同前面所说的，贝塞尔曲线是一个可递归的、特殊的样条曲线。但是这里我将主要介绍其众多特性中的一个特性，利用贝塞尔曲线来做插值操作。了解`CSS3`的都很清楚，我们在`transition`和`animation`中都有用到贝塞尔的插值功能，比如我想让一个物体先加速再减速的往右运动，那么这个过程应该如何实现呢？

在谈` beizer`曲线如何实现动画的加减速变换之前我们先来探讨一下动画是什么，程序上一般有几种方式来处理动画过程。

首先动画最简单的定义就是物体的一连贯的动作我们就可以称作为动画，例如汽车的移动，风扇的转动，窗帘的摇摆。在现实世界中这些动作从广义上来讲它们是时间上连续的也就是说它是在时间轴上的一个函数，但是从物理的角度上来看待这些动画的话它们可以描述成基于速度的连续累积。因此在程序实现的动画中我们也经常使用这两种方式来实现动画：`基于时间` 和 `基于物理量`(速度、加速度、摩擦等)。

基于物理量很好理解，物理里面的一大领域就是来研究物体运动的，比如一个物体的自由落体我们知道就有两个物理量`当前速度`和`加速度`。如果是在程序里面模拟物体的自由落体那就是两个变量，比如下面代码：

```javascript
var ball = { y: 0 };
var speed = 1;
var acceleration = 0.1;

setInterval(function() {
  speed += acceleration;
  ball.y += speed;
}, 1000/30);
```

这样就实现了一个最简单的基于物理量的动画。

除了基于物理量的方式来处理动画，还有基于时间的方式，这也是我们这次所要讲的方式。之前讲了从广义上来讲基于时间的运动其实可以看成是物体位置属性在时间轴上的一个函数。比如我们期望物体在1s内在X轴从0移动到20的位置，这个过程可以用函数`Xt = Fn(t，duration, start, end)`(t的区间为[0, duration])来表示。如果是匀速的话那么`Fn`的实现方式就是:

```javascript
function Fn(t, duration, start, end) {
  var progress = t / duration;
  return start + (end - start) * progress;
}
```

如果是加速的话就可以是:

```javascript
function Fn(t, duration, start, end) {
  var progress = t / duration;
  return start + (end - start) * progress * progress;
}
```

其实这里的原理很简单，`progress`是一个[0, 1]之间的数值，那么我们对他进行一个平方就会得到一个开始平缓然后逐渐陡峭的曲线。

> 红色为`y=x`函数的曲线，蓝色为`y = x^2`函数的曲线，绿色为`y=x^3`函数的曲线

![y=x^2](https://jasonchen1982.github.io/blog/source/math/y=x^2.png)

如果仔细看你会发现这就是一个插值的过程，利用该曲线在`start`和`end`之间进行插值，插值的比例根据不同的函数来进行曲线平滑的调整。插值的进度一般使用`X轴`作为输入（可视为时间进度），`Y轴`作为输出值（也就是实际使用的插值比例）。

用来调整插值比例的曲线有很多种，除了刚才说的`y = x^2`或者`y=sqrt(x)`这些曲线，还有一些其他的数学曲线。例如运用的最为广泛的`cubic-bezier`曲线来实现同样的插值效果，并且插值效果更丰富。

再开始之前我们先来看看`cubic-bezier`曲线长什么样：

![y=x^2](https://jasonchen1982.github.io/blog/source/math/cubic-beizer.png)

是不是发现和前面的曲线类似，同样我们以`X轴`作为输入，`Y轴`作为输出的话就能通过在限定的区域内变换控制点从而得到各种形式的插值曲线了。但是由上次讲到的`bezier curve`中我们知道`bezier curve`公式的输入量是进度`t`，然后得到曲线在该处的坐标点`(x, y)`，但是我们这里是希望用`x`作为输入量，然后得到的`y`作为输出量来进行实际的插值。也就是说我们现在的需求是已知`x`想求出`cubic-beizer`曲线上所对应的`y`。



